{% extends 'base.html.twig' %}

{% block body %}
    <div class="card text-center">
        <div class="card-body">
            <h4 class="textPurpleDark mb-4">Ajouter vos Aliments</h4>
            {{ form_start(form) }}
            {{ form_row(form.date) }}
            {{ form_row(form.time) }}
            <h5 class="textPurpleDark mt-4 mb-2">Catégorie : </h5>
            <p class="mb-1">(Sélectionnez une catégorie pour filtrer la liste d'aliments) </p>
            {{ form_row(form.category) }}
            <h5 class="textPurpleDark mt-4 mb-1">Aliment : </h5>
            {{ form_row(form.food) }}
            <button class="btn btn-lg btn-bobo mt-2">{{ button_label|default('Ajouter') }}</button>
            {{ form_end(form) }}
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    {{ encore_entry_script_tags('app') }}

    <script>
        let $category = $('#add_foods_category');
        // When category gets selected ...
        $category.change(function() {
            // ... retrieve the corresponding form.
            let $form = $(this).closest('form');
            // Simulate form data, but only include the selected category value.
            let data = {};
            data[$category.attr('name')] = $category.val();
            // Submit data via AJAX to the form's action path.
            $.ajax({
                url : $form.attr('action'),
                type: $form.attr('method'),
                data : data,
                success: function(html) {
                    // Replace current food field ...
                    $('#add_foods_food').replaceWith(
                        // ... with the returned one from the AJAX response.
                        $(html).find('#add_foods_food')
                    );
                    // Food field now displays the appropriate positions.
                }
            });
        });
    </script>

{% endblock %}